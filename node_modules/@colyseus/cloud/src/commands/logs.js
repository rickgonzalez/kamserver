import config, { getColyseusConfig } from '../config.js';
import EventSource from 'eventsource';

export default async function logs(options) {
  console.log("ℹ️  This feature is experimental and may change in the future.");

  const env = (await getColyseusConfig(options)).current;
  const eventSource = new EventSource(`${config.endpoint}/api/application/${env.applicationId}/logs`, {
    headers: { 'Authorization': 'Bearer ' + env.token }
  });

  eventSource.onmessage = function(evt) {
    console.log(JSON.parse(evt.data));
  };

  eventSource.onerror = function (evt) {
    console.error(`Connection lost with application server.`);
    eventSource.close();
  };
};

