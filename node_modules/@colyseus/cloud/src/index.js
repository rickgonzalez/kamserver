import minimist from "minimist";
import deploy from "./commands/deploy.js";
import logs from "./commands/logs.js";

const argv = minimist(process.argv.slice(2));
const cmd = argv._[0];

if (argv.help) {
  console.log(`colyseus-cloud deploy

Options:
  --env [env]       The deployment environment (default: "production")
  --remote          Force a specific git remote to deploy from. Value is stored on .colyseus-cloud.json
  --branch          Force a specific git branch to deploy from. Value is stored on .colyseus-cloud.json
  --reset           Reset application selection for deployment
  --preview         Open web interface to preview the deployment.

Usage examples:

  npx @colyseus/cloud deploy --env testing
  npx @colyseus/cloud deploy --reset
  npx @colyseus/cloud deploy --branch master --remote git@github.com:endel/colyseus-cloud-deployment-test.git

`);
  process.exit();
}

const commands = { deploy, logs, };

if (!commands[cmd]) {
  console.error(`"${cmd}" is not a valid command!`);
  process.exit(1);

} else {
  try {
    commands[cmd](argv);

  } catch (e) {
    console.error(e);
  }
}
